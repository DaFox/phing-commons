<?xml version="1.0" encoding="UTF-8"?>

<!-- ============================================================  -->
<!-- report                                                        --> 
<!--                                                               --> 
<!-- @author Jan Thoennessen <jan.thoennessen@googlemail.com>      --> 
<!-- ============================================================  -->
<project name="report">



    <!-- ============================================  -->
    <!-- help.report                                   --> 
    <!-- ============================================  -->	
	<target name="help.report">
		<echo message="report.phpcpd      (PHP Copy and Paste Detection)" />
		<echo message="report.phpdepend   (PHP Software Metrics)"         />
		<echo message="report.phpmd       (PHP Mess Detection)"           />
		<echo message="report.codesniffer (PHP Checkstyle Code Analysis)" />
		<echo message="report.apigen      (PHP API Documentation)"        />
		<echo message="report.clean       (clean all reports)"            />
		<echo message="report             (run all)"                      />
	</target>
		
	
		
    <!-- ============================================  -->
    <!-- report.phpcpd                                 -->
    <!-- ============================================  -->
    <target name="report.phpcpd" depends="init.patternset.report.phpcpd,test.phplint">
        <mkdir dir="${build.reports}/phpcpd" />
        
        <phpcpd>
            <fileset dir=".">
                <patternset refid="fileset.pattern.report.phpcpd" />
            </fileset>
			
            <formatter type="pmd" outfile="${build.reports}/phpcpd/phpcpd.xml" />
        </phpcpd>
        
        <xslt file="${build.reports}/phpcpd/phpcpd.xml" tofile="${build.reports}/phpcpd/index.html" style="${phing:commons:xsl}/phpcpd.xsl" />
    </target>
    
    
    
    <!-- ============================================  -->
    <!-- report.phpdepend                              -->
    <!-- ============================================  -->
    <target name="report.phpdepend" depends="init.patternset.report.phpdepend,test.phplint">
        <mkdir dir="${build.reports}/phpdepend" />
        
        <phpdepend>
            <fileset dir=".">
                <patternset refid="fileset.pattern.report.phpdepend" />
            </fileset>
            
            <logger type="jdepend-xml"      outfile="${build.reports}/phpdepend/phpdepend.xml"        />
            <logger type="jdepend-chart"    outfile="${build.reports}/phpdepend/chart.png"            />
            <logger type="overview-pyramid" outfile="${build.reports}/phpdepend/overview-pyramid.png" />
            
            <analyzer type="coderank-mode" value="method" />
        </phpdepend>
        
        <xslt file="${build.reports}/phpdepend/phpdepend.xml" tofile="${build.reports}/phpdepend/index.html" style="${phing:commons:xsl}/phpdepend.xsl" />
    </target>
    
    
        
    <!-- ============================================  -->
    <!-- report.phpmd                                  -->
    <!-- ============================================  -->
    <target name="report.phpmd" depends="init.patternset.report.phpmd,test.phplint">
        <mkdir dir="${build.reports}/phpmd" />
        
        <phpmd>
            <fileset dir=".">
                <patternset refid="fileset.pattern.report.phpmd" />
            </fileset>
            
            <formatter type="xml" outfile="${build.reports}/phpmd/phpmd.xml" />
        </phpmd>
        
        <xslt file="${build.reports}/phpmd/phpmd.xml" tofile="${build.reports}/phpmd/index.html" style="${phing:commons:xsl}/phpmd.xsl" />
    </target>
    
    
      
    <!-- ============================================  -->
    <!-- report.codesniffer                            -->
    <!-- ============================================  -->
    <target name="report.codesniffer" depends="init.patternset.report.codesniffer,test.phplint">
        <mkdir dir="${build.reports}/codesniffer" />
        <mkdir dir="${build.reports}/codesniffer-overview" />
        
        <phpcodesniffer standard="Zend" showSniffs="true" showWarnings="true" docGenerator="HTML" docFile="${build.reports}/codesniffer-overview/index.html">
            <fileset dir=".">
                <patternset refid="fileset.pattern.report.codesniffer" />
            </fileset>
            
            <formatter type="checkstyle" outfile="${build.reports}/codesniffer/checkstyle.codesniffer.xml" />
        </phpcodesniffer>
        
        <xslt file="${build.reports}/codesniffer/checkstyle.codesniffer.xml" tofile="${build.reports}/codesniffer/index.html" style="${phing:commons:xsl}/checkstyle.codesniffer.xsl" />
    </target>
    
    
    
    <!-- ============================================  -->
    <!-- report.apigen                                 -->
    <!-- ============================================  -->
    <target name="report.apigen" depends="test.phplint">
        <mkdir dir="${build.reports}/apigen" />
        <mkdir dir="${build.reports}/apigen-checkstyle" />
        
        <apigen 
        config="./build.properties.apigen" 
        destination="${build.reports}/apigen" 
        report="${build.reports}/apigen-checkstyle/checkstyle.apigen.xml" />

        <xslt file="${build.reports}/apigen-checkstyle/checkstyle.apigen.xml" tofile="${build.reports}/apigen-checkstyle/index.html" style="${phing:commons:xsl}/checkstyle.apigen.xsl" />
    </target>
    
    
     
    <!-- ============================================  -->
    <!-- report.clean                                  -->
    <!-- ============================================  -->
    <target name="report.clean">
        <echo msg="run report.clean" />
        
        <delete dir="${build.reports}" />
        <mkdir  dir="${build.reports}" />
        
        <echo msg="end report.clean" />
    </target> 
    
    
    
    <!-- ============================================  -->
    <!-- report                                        -->
    <!-- ============================================  -->
    <target name="report" depends="report.clean,report.phpcpd,report.phpdepend,report.phpmd,report.codesniffer,report.apigen" />
    
    
    
</project>